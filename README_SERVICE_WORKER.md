# Service Worker Update Strategy

This app implements a user-controlled service worker update strategy. When a new version of the app is available, users are notified via a toast notification and can choose when to update.

## How It Works

1. **Update Detection**: The `useServiceWorkerUpdate` hook detects when a new service worker is installed and waiting.

2. **User Notification**: When an update is available, the `UpdateNotification` component displays a toast notification with "Update Now" and "Later" buttons.

3. **Update Activation**: When the user clicks "Update Now", the hook sends a `SKIP_WAITING` message to the waiting service worker and triggers a page reload.

## Service Worker Configuration

The service worker is configured in `next.config.js` with:
- `skipWaiting: false` - Prevents automatic activation
- `clientsClaim: false` - Prevents automatic client claiming

## Important Note

The service worker generated by `next-pwa` needs to listen for `SKIP_WAITING` messages. By default, Workbox (used by next-pwa) doesn't automatically handle these messages.

To make this work, you may need to:
1. Use a custom service worker source file (`swSrc` option in next-pwa)
2. Or manually add a message listener to the generated service worker

Example service worker code to handle SKIP_WAITING:
```javascript
self.addEventListener('message', (event) => {
  if (event.data && event.data.type === 'SKIP_WAITING') {
    self.skipWaiting()
  }
})
```

## Testing

To test the update flow:
1. Build the app: `npm run build`
2. Deploy or serve the built app
3. Make a change to the app
4. Rebuild and redeploy
5. The update notification should appear when you visit the app

